
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>BLog</title>
	<meta name="author" content="Brian Leonard">

	
	<meta name="description" content="1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
To rewrite, or not to rewrite- that is the question &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="BLog" type="application/atom+xml">
	
	<link rel="canonical" href="http://bleonard.github.io/blog/page/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/assets/slides/css/for_blog.css">
	
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37352049-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>

<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<a href="/"><img src="/images/dp.jpg" alt="Profile Picture" style="width: 160px;"></a>
</div>
<h1><a href="/">BLog</a></h1>
<p class="subtitle">Strong catchphrase situation here</p>
<p class="description">Chief Architect and Technical Co-founder of TaskRabbit - neighbors helping neighbors through technology.</p>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
	  
	  <a class="taskrabbit" href="http://www.taskrabbit.com" title="TaskRabbit">TaskRabbit</a>
	  
		
		
		
		<a class="github" href="https://github.com/bleonard" title="GitHub">GitHub</a>
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/BrianL429">LinkedIn</a>
		
		
		<a class="twitter" href="http://twitter.com/bleonard" title="Twitter">Twitter</a>
		
		
		
		
		<a class="rss" href="/atom.xml" title="Feed">Feed</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-10-26T00:00:00-07:00" pubdate data-updated="true">Oct 26<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/code/'>code</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/startups/'>startups</a>, <a class='category' href='/blog/categories/v3/'>v3</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/10/26/rewrite/">To Rewrite or Not to Rewrite?</a></h1>
	<div class="entry-content">
		<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>To rewrite, or not to rewrite- that is the question: 
</span><span class='line'>Whether 'tis better for the product to suffer
</span><span class='line'>The features and debt of outrageous history
</span><span class='line'>Or to once again battle a sea of edge cases,
</span><span class='line'>And by forgetting relive them. To wish- to hope-
</span><span class='line'>No more; and by hope to say we end
</span><span class='line'>The heartache, and the thousand unnatural cases
</span><span class='line'>That code can error to. 'Tis a codebase
</span><span class='line'>Devoutly to be wish'd. To wish- to hope.
</span><span class='line'>To hope- perchance to rebuild: ay, there's the rub!
</span><span class='line'>For in that hope of clarity what simplicity comes
</span><span class='line'>When we have removed this outdated cruft
</span><span class='line'>Must give us success. But give the respect
</span><span class='line'>To the current repo of such long life.
</span><span class='line'>For who would bear the features of the past,
</span><span class='line'>High expectations, the race conditions,
</span><span class='line'>The admin tools, the product delay,
</span><span class='line'>The exhaustion overcome, and the data
</span><span class='line'>That shall posthaste be moved to a new store
</span><span class='line'>As each mistake of the past be brought back
</span><span class='line'>With sighs of regret? Who would these issues bear,
</span><span class='line'>To toil and code under a weary life,
</span><span class='line'>But that the chance of something rebuilt
</span><span class='line'>That undiscover'd codebase, from whose lines
</span><span class='line'>No complexity returns- tempts the will,
</span><span class='line'>And makes us choose between those ills we have
</span><span class='line'>Than sprint towards others we know not of?
</span><span class='line'>Thus the unknowns make cowards of us all,
</span><span class='line'>And thus the heavy weight of such choice
</span><span class='line'>Is oft tempered by promises of thought,
</span><span class='line'>And refactorings of great scope and breadth
</span><span class='line'>With this regard the hope does turn awry
</span><span class='line'>And lose the name of action.- What say you?
</span><span class='line'>The lauded pivot! Siren of opportunity
</span><span class='line'>May all our sins be forgotten.</span></code></pre></td></tr></table></div></figure>


<p>The internal struggle of the rewrite decision eats away at developers. It could be so much better. We have learned so much. Let&#8217;s start over. It causes inaction over months accompanied by much grumbling. But if you do it, how can you make sure it doesn&#8217;t turn into a tragedy?</p>

<p>I can&#8217;t say that I am happy or proud that we have rewritten TaskRabbit twice. That doesn&#8217;t feel right. Conceptually, if we would have done it correctly the first time, then it wouldn&#8217;t have been needed. Or maybe we should have done it in place. I would say that&#8217;s absolutely fair, but doesn&#8217;t capture the reality of development of the last 6 years.</p>

<p>When I started writing this post, I just felt like mapping my existential crisis to Hamlet&#8217;s and now I&#8217;m heading towards defending myself against Joel&#8217;s famous <a href="http://www.joelonsoftware.com/articles/fog0000000069.html">post</a> stating the fact that you should never do a rewrite. I just went back and read it (again) and I (still) agree. It&#8217;s hard to argue with. Maybe it&#8217;s best to discuss the times we did rewrite to the times we didn&#8217;t.</p>


		
		<a href="/blog/2015/10/26/rewrite/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-10-18T00:00:00-07:00" pubdate data-updated="true">Oct 18<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/10/18/building-react-native-apps/">Building React Native Apps</a></h1>
	<div class="entry-content">
		<p>We&#8217;ve been using and loving React Native as noted in my <a href="/blog/2015/09/21/react-native-example-app">previous post</a>. As we are working towards rolling out a fully-featured app, one thing that needed solved was how we should build the app for different environments. For example, how can we make (slightly different) development, staging, and production builds?</p>

<p>In a <a href="https://github.com/facebook/react-native/issues/2246">Github issue</a>, I ran into a few other people also wondering how to do this, so I&#8217;ve added a few ways to the <a href="https://github.com/taskrabbit/ReactNativeSampleApp">Example App</a> to show the approaches we are using.</p>

<p>The three approaches we are trying out are:</p>

<ul>
<li>Configurations</li>
<li>Compile Flags</li>
<li>Run Variables</li>
</ul>


<h2>Environments</h2>

<p>I had already added the <code>Environment</code> <a href="https://github.com/taskrabbit/ReactNativeSampleApp/blob/2cf43f3ce17f830ff17065d6b4d973ac85043b05/App/Models/Environment.js">model</a> and <code>EnvironmentStore</code> <a href="https://github.com/taskrabbit/ReactNativeSampleApp/blob/2cf43f3ce17f830ff17065d6b4d973ac85043b05/App/Stores/EnvironmentStore.js">store</a> to the project. However, I just added actual dynamic configurations to the XCode project and the <code>EnvironmentManager</code> <a href="https://github.com/taskrabbit/ReactNativeSampleApp/blob/2cf43f3ce17f830ff17065d6b4d973ac85043b05/ios/Sample/EnvironmentManager.m">code</a> is using that.</p>


		
		<a href="/blog/2015/10/18/building-react-native-apps/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-10-06T00:00:00-07:00" pubdate data-updated="true">Oct 6<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/code/'>code</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/startups/'>startups</a>, <a class='category' href='/blog/categories/v3/'>v3</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/10/06/v2-retrospective/">V2 - Retrospective</a></h1>
	<div class="entry-content">
		<p>TaskRabbit began as <a href="http://www.boston.com/business/technology/articles/2009/07/05/web_start_up_takes_entrepreneurs_idea_and_runs_with_it/">RunMyErrand</a> in 2008 when Leah had the <a href="http://techli.com/2011/09/taskrabbit-interview-leah-busque/">idea</a> and coded up the first version of the site. In 2009, I had the opportunity to help out in little ways like adding Facebook Connect support just after it launched and Leah got into <a href="http://techcrunch.com/2009/05/28/facebook-names-first-class-of-fbfund-rev-its-new-incubator/">Facebook Fund</a>. From there, she raised a <a href="http://www.xconomy.com/boston/2009/10/30/runmyerrand-picks-up-1-million-from-west-coast-venture-firms/">seed round</a> and I came on full-time.</p>

<p>For a few weeks after starting, I worked on the RunMyErrand codebase, adding features and fixing bugs. Quickly, though, a few things became clear. First, we were probably going to change our name. RunMyErrand made people think only about laundry. Second, the changes we wanted to make drastic and hard to make with confidence in a codebase with no tests. I was hoping to work and live with this code for several years and we did not have the foundation that would make that a productive and enjoyable experience.</p>

<p>So around Christmas 2009, I started a new Rails project. It was still called <code>runmyerrand</code> because we still didn&#8217;t have a new name. For a while at the end we called it <code>core</code> because it was at the center of a large service-oriented architecture. Today, we call it <code>V2</code> because it has now itself been replaced.</p>

<p>It&#8217;s been a year and half. It&#8217;s never too late for a retrospective.</p>

<h2>Launch</h2>

<p>The original site was my first Rails project to work on and V2 was my first one from scratch. Rails 3 wasn&#8217;t yet released so I was nervous to get on that bleeding edge because most of the gems didn&#8217;t work quite yet. I had been immersing myself in Ruby news. In particular, I&#8217;d been listening to <a href="http://ruby5.envylabs.com/">Ruby5</a> and others podcasts and been taking notes about gems/tools that seemed relevant. In hindsight and with experience, it was a problem to rely on gems for fairly simple things, but at the time they seemed sent from heaven to solve my problems.</p>

<p>I started over Christmas at the very beginning.</p>

<div class="jumbotron">
  <image src="/images/posts/v2-retrospective/tracker2009.png" alternate="Tracker 2009" class="bigPicture" />
</div>


<p>The site was black and white with a simple layout. At some point in January, Leah saw what I was working on. I, of course, discussed with her the notion of rebuilding the site, but I don&#8217;t think the ramifications quite came across until she saw the starkness of that layout. It was probably a huge leap of faith for her at that moment to have the trust in me that she did.</p>

<p>I worked on both sites through January and February, eventually getting to 100% on new stuff. For the most part, I was building a feature-complete version of RunMyErrand with TBD branding and stronger Rails conventions like <a href="http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model">skinny controllers</a> and tests. There were some new features and many minor upgrades from the learnings we&#8217;d had.</p>

<p>By the end of April, it was about ready to go. We had <a href="http://blog.taskrabbit.com/2010/04/08/runmyerrand-is-now-taskrabbit/">picked a name</a>, gotten help from <a href="http://www.mikekivikoski.com/">designers</a> and <a href="https://twitter.com/dpickett">Dan</a>, a great contractor to pull it over the finish line. In one hour on <a href="http://bostinno.streetwise.co/2010/04/13/runmyerrand-relaunches-with-new-name/">April 5th</a>, we launched the new code and rebranded the company.</p>


		
		<a href="/blog/2015/10/06/v2-retrospective/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-09-21T00:00:00-07:00" pubdate data-updated="true">Sep 21<span>st</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/ios/'>ios</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/09/21/react-native-example-app/">React Native Example App: Navigation</a></h1>
	<div class="entry-content">
		<p>At <a href="http://www.taskrabbit.com">TaskRabbit</a>, we have been looking into building an iOS application in <a href="https://facebook.github.io/react-native/">React Native</a>. This is probably the first pure technology that I&#8217;ve been this excited about since moving from C to Ruby.</p>

<p>However, it&#8217;s definitely still in its early days. There are not many examples of how people are doing things out there. To help remedy this and share what we are learning, I made a <a href="https://github.com/taskrabbit/ReactNativeSampleApp">sample React Native application</a>.</p>

<div class="jumbotron">
  <image src="/images/posts/react-native-navigation/screenshots.png" class="bigPicture" />
</div>


<p>The app itself is vaguely like twitter and/or tumblr. There are users that make posts. They follow other users. You can look at users they follow follows and those users&#8217; posts. And on and on! The features (or styling) isn&#8217;t the main point. At this time, we&#8217;re mostly demonstrating architectural concepts.</p>

<p>The app we&#8217;re working on is a bit ahead of this one, but I think it will be neat to have this one publicly walk through the same steps that we have done privately. Everything is pretty new and the patterns are not established. We&#8217;ll post here about some pattern or refactor and update the app and hopefully start a great conversation.</p>

<h2>Navigation</h2>

<p>The first pattern that I wanted to talk about is navigation. The web has a pretty solid navigation story (with the URLs and such) and some <a href="https://github.com/rackt/react-router">tools</a> to map that to React applications. I think it&#8217;s less clear on the phone.</p>

<p>I&#8217;m not sure why it&#8217;s different, actually, because there is still usually a &#8220;Back&#8221; button and one screen at a time. Yet, iOS development seems to have evolved in another direction. Most apps are all about this <code>NavigationController</code> and we <code>push</code> and <code>pop</code> and stuff like that. Then things get totally weird when we try to put the URLs back in for something like <a href="http://blog.originate.com/blog/2014/04/22/deeplinking-in-ios/">deep linking</a>.</p>


		
		<a href="/blog/2015/09/21/react-native-example-app/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-08-01T00:00:00-07:00" pubdate data-updated="true">Aug 1<span>st</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/css/'>css</a>, <a class='category' href='/blog/categories/home/'>home</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/08/01/teaching-css/">Teaching CSS</a></h1>
	<div class="entry-content">
		<p>To my surprise, my daughter asked me if I would teach her how to build a web site today. She more or less wants a blog to keep track of what is going on at a recess club she made at school: regular notes, calendar, things like that.</p>

<p>I had her draw out on paper what she wanted to build. It was interesting to see her reinvent the concept of a blog. For example, her first iteration only showed the post from &#8220;Today.&#8221; I asked her how you would see yesterday&#8217;s post. So she add a &#8220;Today&#8221; and a &#8220;Yesterday&#8221; button. So I asked her how to see the post from last week. Her answer was approximately, &#8220;Well, they just need to keep up!&#8221; However, she eventually conceded to a &#8220;Previous&#8221; and &#8220;Next&#8221; button.</p>

<p>Even on one&#8217;s first encounter, it seems that it&#8217;s impossible to teach this stuff without also teaching about concessions:</p>

<p><strong>Daughter</strong>: OK, here&#8217;s a picture of what I want to make (shows few buttons on top, content underneath)</p>

<p><strong>Dad</strong>: (Talks about closing and opening tags, gets a word on the page)</p>

<p><strong>Daughter</strong>: Make it bigger.</p>

<p><strong>Dad</strong>: (adds <code>h1</code> tag)</p>

<p><strong>Daughter</strong>: Add the other buttons.</p>

<p><strong>Dad</strong>: (adds two more <code>h1</code> tags)</p>

<p><strong>Daughter</strong>: Why are they not next to each other?</p>

<p><strong>Dad</strong>: (mumbles about <code>ul</code> and <code>li</code> - makes them a list)</p>

<p><strong>Daughter</strong>: Now they are too small again and have those dots.</p>

<p><strong>Dad</strong>: We need to &#8220;style&#8221; them. Let&#8217;s remove the dots. (inlines styles: <code>list-style-type:none;</code>)</p>

<p><strong>Daughter</strong>: OK. Now make it bigger again.</p>

<p><strong>Dad</strong>: (adds <code>font-size:50px;</code> to the first one) There.</p>

<p><strong>Daughter</strong>: What about the other ones?</p>

<p><strong>Dad</strong>: How do you think we make them bigger too?</p>

<p><strong>Daughter</strong>: (eventually adds inline style to other ones). Perfect! Now put them next to each other.</p>

<p><strong>Dad</strong>: (adds <code>display:inline;</code>)</p>

<p><strong>Daughter</strong>: You&#8217;re amazing! Ok, now make the background gold.</p>

<p><strong>Dad</strong>: (<code>background-color:Gold</code>)</p>

<p><strong>Daughter</strong>: That&#8217;s yellow.</p>

<p><strong>Dad</strong>: Here, look at <a href="http://www.w3schools.com/cssref/css_colornames.asp">this</a>.</p>

<p><strong>Daughter</strong>: Wow, so many choices! (picks GoldenRod)</p>

<p><strong>Dad</strong>: (shows how to change to that)</p>

<p><strong>Daughter</strong>: Perfect! Now make the buttons this one (points to DarkTorquise)</p>

<p><strong>Dad</strong>: (adds links makes them <code>background-color:DarkTurquoise;padding: 10px;</code>)</p>

<p><strong>Daughter</strong>: OK, let&#8217;s add the main words. In a white box.</p>

<p><strong>Dad</strong>: (adds <code>div</code> with <code>background-color:White;</code> and a few words)</p>

<p><strong>Daughter</strong>: Why is it so small?</p>

<p><strong>Dad</strong>: We need more words. (pastes Lorem Ipsum)</p>

<p><strong>Daughter</strong>: (not impressed) It needs to be bigger and in the middle.</p>

<p><strong>Dad</strong>: (adds <code>padding:20px;margin-left:auto;margin-right:auto;</code> to horizontally center content) How about that?</p>

<p><strong>Daughter</strong>: Also in the middle between the top and bottom.</p>

<p><strong>Dad</strong>: (sighs heavily. googles &#8220;vertical center div css&#8221; for the 100th time. reads for 7 minutes.)</p>

<p><strong>Daughter</strong>: What&#8217;s wrong?</p>

<p><strong>Dad</strong>: Are you sure you don&#8217;t want it near the top?</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-07-01T00:00:00-07:00" pubdate data-updated="true">Jul 1<span>st</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/business/'>business</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/07/01/okrs/">OKRs</a></h1>
	<div class="entry-content">
		<p>At <a href="http://www.taskrabbit.com">TaskRabbit</a>, we have something called Objectives and Key Results or <a href="https://en.wikipedia.org/wiki/OKR">OKRs</a> for short. Many companies do the same.</p>

<p>We&#8217;ve always talked about them as one thing. As in, &#8220;What&#8217;s the OKR?&#8221; That would more or less mean, &#8220;What number are we trying to hit?&#8221; An example would be getting better at fulfilling tasks by focusing on moving up the percentage of tasks that are posted and get successfully completed.</p>

<p>This metrics-driven approach can really work but its efficacy seems related to the metric chosen. If the team believes it&#8217;s the right number to move, it works out. If they see weird loopholes or tricks, then it is less effective. Because of this, there is much discussion each time about the best metric to focus upon. Assuming we don&#8217;t focus on something all-encompassing (&#8220;Revenue&#8221;), it often has turned out to be very difficult to find exactly the right metric.</p>

<p>My recent realization is that there are objectives <em>and</em> key results. Of course, that&#8217;s obvious because it&#8217;s the name of the thing. However, in my mind, I don&#8217;t think I ever separated them to the degree that they deserve to be separated. It was always about hitting the metric and that <em>was</em> the objective. The goal, as I now understand it, should be to make the objective more of the &#8220;intent&#8221; of the situation. The key result is simply a way to &#8220;sample&#8221; that intent.</p>

<h3>Example</h3>

<p>As an example, we could have an objective of &#8220;making TaskRabbit a habit.&#8221; I think it&#8217;s helpful to make it completely about the intent and not something like &#8220;increasing lifetime value&#8221; or &#8220;doubling monthly active users&#8221; or whatever. That helps when making decisions throughout the quarter and is open to interpretation as the understanding of it evolves. The key result, then, is for sampling the progress. It could be &#8220;increase the average number of tasks per month to X&#8221; or &#8220;get Y% more people to their 4th completed task,&#8221; or &#8220;increase the average number of consecutive weeks of usage to Z&#8221; or any number of other options.</p>

<p>Each metric will have its holes, but the best metrics will be the one or two that:</p>

<ul>
<li>are highly correlated to the intent of the objective</li>
<li>can be sampled frequently to understand and measure progress</li>
<li>are easily explainable and understandable to everyone</li>
</ul>


<p>This produces a metric that doesn&#8217;t have to have its nuances explained every time we talk about it, can be on the wall in dashboard form to see if it&#8217;s going well, and that we believe is a good enough sample of the goal.</p>


		
		<a href="/blog/2015/07/01/okrs/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-06-04T00:00:00-07:00" pubdate data-updated="true">Jun 4<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/math/'>math</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/06/04/big-decimal/">Big Decimal</a></h1>
	<div class="entry-content">
		<p>At <a href="http://www.taskrabbit.com">TaskRabbit</a>, people have hourly rates for the tasks that they do. They get paid based on the number of hours that they work.</p>

<p>We try to deal in base units to remove ambiguity. For example, we store the hourly rate in cents as an integer instead of in dollars as a double. Reporting time worked occurs in seconds. When that reporting occurs, there is a calculation to do to understand how much the Tasker needs to be paid. It might go something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">FloatCalculator</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">hourly_rate_in_cents</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@hourly_rate_in_cents</span> <span class="o">=</span> <span class="n">hourly_rate_in_cents</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">total_in_dollars</span><span class="p">(</span><span class="n">seconds_worked</span><span class="p">)</span>
</span><span class='line'>    <span class="n">hours</span> <span class="o">=</span> <span class="n">seconds_worked</span> <span class="o">/</span> <span class="mi">3600</span><span class="o">.</span><span class="mi">0</span> <span class="c1"># seconds in an hour</span>
</span><span class='line'>    <span class="n">cents</span> <span class="o">=</span> <span class="vi">@hourly_rate_in_cents</span> <span class="o">*</span> <span class="n">hours</span>
</span><span class='line'>    <span class="n">dollars</span> <span class="o">=</span> <span class="n">cents</span> <span class="o">/</span> <span class="mi">100</span> <span class="c1"># make it dollars</span>
</span><span class='line'>    <span class="n">dollars</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Over the years, we saw a few errors because of <a href="http://floating-point-gui.de/">limitations of floating point math</a>. Since then, we have switched to using <a href="http://ruby-doc.org/stdlib-2.1.5/libdoc/bigdecimal/rdoc/BigDecimal.html">BigDecimal</a> to prevent these kinds of errors.</p>

<p>There were no visible performance issues, but I recently got curious because all of the docs say that they are substantial. By writing the same calculator using BigDecimal, we can see the difference.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BigDecimalCalculator</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">hourly_rate_in_cents</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@hourly_rate_in_cents</span> <span class="o">=</span> <span class="no">BigDecimal</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hourly_rate_in_cents</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">total_in_dollars</span><span class="p">(</span><span class="n">seconds_worked</span><span class="p">)</span>
</span><span class='line'>    <span class="n">hours</span> <span class="o">=</span> <span class="no">BigDecimal</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">seconds_worked</span><span class="p">)</span> <span class="o">/</span> <span class="no">BigDecimal</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cents</span> <span class="o">=</span> <span class="vi">@hourly_rate_in_cents</span> <span class="o">*</span> <span class="no">BigDecimal</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hours</span><span class="p">)</span>
</span><span class='line'>    <span class="n">dollars</span> <span class="o">=</span> <span class="n">cents</span> <span class="o">/</span> <span class="no">BigDecimal</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span class='line'>    <span class="n">dollars</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This does turn out to be significantly slower, so I also benchmarked marking the constants class level variables.</p>


		
		<a href="/blog/2015/06/04/big-decimal/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-04-02T00:00:00-07:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/queue/'>queue</a>, <a class='category' href='/blog/categories/resque/'>resque</a>, <a class='category' href='/blog/categories/sidekiq/'>sidekiq</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/04/02/queue-bus/">Queue Bus</a></h1>
	<div class="entry-content">
		<p>At <a href="http://www.taskrabbit.com">TaskRabbit</a>, we have been using <a href="/blog/2013/09/28/resque-bus/">resque-bus</a> for about two years. It has continued to provide value by  linking components via a loosely coupled publish/subscription model. We have seen 10x the number of events going through it, but have not yet hit any scaling issues. The benefit of using the tools we already have continues to be a huge win.</p>

<p>But other teams are using other tools like <a href="http://sidekiq.org/">Sidekiq</a>. We&#8217;re also interested in trying it out, but resque-bus (unsurprisingly) was tied closely to <a href="https://github.com/resque/resque">Resque</a>. We&#8217;ve changed that by creating <a href="https://github.com/queue-bus/queue-bus">queue-bus</a> and using an adapter pattern. There are now adapters in <a href="https://github.com/queue-bus/resque-bus">resque-bus</a> and <a href="https://github.com/queue-bus/sidekiq-bus">sidekiq-bus</a>, as well as a compatible version in <a href="https://github.com/queue-bus/node-queue-bus">node-queue-bus</a>.</p>

<p>The code interactions are basically the same but can work across systems. You can even have one app using Resque and one using Sidekiq.</p>

<h4>Pick your adapter</h4>

<p>By requiring one of the adapters, it automatically gets set up to be the one for the app.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sidekiq-bus&#39;</span> <span class="c1"># (or &#39;resque-bus&#39;)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Application A publishes an event</h4>

<p>Something happens in your application and you want to let the world know. In this case, you publish an event.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># business logic</span>
</span><span class='line'><span class="no">QueueBus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;user_created&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="n">first_name</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># or do it later</span>
</span><span class='line'><span class="no">QueueBus</span><span class="o">.</span><span class="n">publish_at</span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">from_now</span><span class="p">,</span> <span class="s2">&quot;user_created&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="n">first_name</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Application B subscribes to events</h4>

<p>If the same or different application is interested when an event happens, it subscribes to it by name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># initializer</span>
</span><span class='line'><span class="no">QueueBus</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;app_b&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">subscribe</span> <span class="s2">&quot;user_created&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">attributes</span><span class="o">|</span>
</span><span class='line'>    <span class="c1"># business logic</span>
</span><span class='line'>    <span class="no">NameCount</span><span class="o">.</span><span class="n">find_or_create_by_name</span><span class="p">(</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;last_name&quot;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">increment!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Upgrading</h3>

<p>The formats changed a little bit with the move. The last version that used the old format (0.3.7) also can adapt to the new format. This is important because you&#8217;ll have things in the queue during the transition.</p>

<p>Steps:</p>

<ul>
<li>Upgrade everyone to 0.3.7</li>
<li>Deploy all the things</li>
<li>Upgrade everyone to the newest version</li>
</ul>


<h3>More to come</h3>

<p>If people continue to like this approach and gem, we have lots of approaches and tools built on top of it that we&#8217;d be excited to make available. Let us know on <a href="https://github.com/queue-bus/queue-bus">Github</a> that you like it by watching, starring, or creating issues with questions, etc.</p>

<p>Now that we have the adapter pattern, also let us know if you are interested in making one for your background system of choice. A special thanks goes out to <a href="https://github.com/jonsgreen">Jonathan Greenberg</a> and the team at <a href="http://www.purpose.com/">purpose.com</a> who did just that to get this whole thing going.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-16T00:00:00-08:00" pubdate data-updated="true">Feb 16<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/apple/'>apple</a>, <a class='category' href='/blog/categories/dashboard/'>dashboard</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/16/apple-tv-dashboard/">Apple TV Dashboard</a></h1>
	<div class="entry-content">
		<p>So you have all these screens around and you want to have something awesome like on those one that Panic <a href="http://www.panic.com/blog/panic-status-board-2013-edition/">made</a>. You may also already have Apple TVs on these TVs because AirPlay is an effective way to project screens in an office full of Macs. This is position we were in at <a href="https://www.taskrabbit.com">TaskRabbit</a> and we&#8217;d tried a few things.</p>

<p>The most recent iteration was to have one Mac Mini in a closet and lots of very long wires into the TVs. It displayed a web page that cycled through the content. This wasn&#8217;t bad, but had a few issues. First, the screens all had to show the same thing. I wanted to be able to have different content on each. For example, in addition to key metrics, the conference rooms would have who had the room booked or the one by customer support would have more data on the call volume. But it just isn&#8217;t worth it to have 10 Mac Minis for this purpose. The other issue is that people still wanted to use Airplay, so they would switch the input and then not switch it back to the ambient content.</p>

<p>The solution seemed clear. I needed to get the dashboards to be the screensaver of an Apple TV.</p>

<h2>TLDR</h2>

<p><a href="https://github.com/bleonard/dashing_on_appletv">Here</a> is a sample project to ties all of this up into one package.</p>

<p>It uses the new gems, <a href="https://github.com/taskrabbit/dashing-screenshots">dashing-screenshots</a> and <a href="https://github.com/taskrabbit/icloud-photo">icloud-photo</a>, to take screenshots and upload them to iCloud. These then show up on an Apple TV</p>

<div class="jumbotron">
<img alt="Sample dashboard on the wall" src="/images/posts/appletv/sampletv.jpg" class="bigPicture" />
</div>


<p>(not actual dashboard)</p>

<p>To make this happen, check out the <a href="https://github.com/bleonard/dashing_on_appletv">project</a> and follow the instructions there.</p>

<h2>Dashboard</h2>

<p>Looking around at <a href="https://ducksboard.com/">various</a> <a href="https://www.geckoboard.com/">dashboard</a> <a href="http://panic.com/statusboard/">apps</a> and having made a few custom solutions, I settled on <a href="http://dashing.io/">Dashing</a> this time. It looked nice by default, had a great model for adding custom content, and is written in the language we tend to use around here (Ruby).</p>

<p>The Dashing <a href="http://dashing.io/#setup">docs</a> are quite good so I won&#8217;t go into detail of how we pulled in our data. The <a href="http://dashing.io/#widgets">samples</a> are actually the best as they show a simple use case of the pattern of how to add <code>jobs</code>. I made some helpers to be able to pull in data from <a href="http://www.looker.com/">Looker</a>. By putting the actual data in Looker, I&#8217;m hoping it will allow others to maintain the metrics definitions. This will hopefully keep the dashboard up to date and relevant. An issue we&#8217;ve had in the past is that the SQL became somewhat stale.</p>

<h2>Screenshots</h2>

<p>I&#8217;d like a fully dynamic dashboard as much as the next guy, but the screensaver of an Apple TV consists only of images. Therefore, the next step was to get a screenshot of all of the dashboards that Dashing has to offer. I have worked on a similar project within our test suite and had great success with <a href="https://rubygems.org/gems/selenium-webdriver">Selenium</a>. I added <code>selenium-webdriver</code> to the Gemfile and this file to <code>lib</code>.</p>


		
		<a href="/blog/2015/02/16/apple-tv-dashboard/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-01-06T00:00:00-08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/i18n/'>i18n</a>, <a class='category' href='/blog/categories/rails/'>rails</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/01/06/translating-rails-fields/">Translating Rails Fields</a></h1>
	<div class="entry-content">
		<p>When we launched <a href="https://www.taskrabbit.com">TaskRabbit</a> in London, one of our goals was to have a fully localized product. There are enough differences between British English and US English to not cut (m)any corners. Of course, it&#8217;s even more important in completely different languages.</p>

<p>An issue that I noticed one day was in our signup flow. It said &#8220;Last name is required.&#8221; This was caused by a blank field and a model-level validation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="n">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It was working as expected, but it should have said &#8220;Surname is required.&#8221; That&#8217;s what they want across the pond.</p>

<p>We translate all of our &#8220;en&#8221; locale into &#8220;en-GB&#8221; but this wasn&#8217;t there because it more or less works automatically. <a href="http://api.rubyonrails.org/classes/ActiveModel/Validations.html">Active Model</a> does a <code>humanize</code> call on the field name. To translate this field, which we had done on stranger field names, you add it to a YML locale file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">en</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">activerecord</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">last_name</span><span class="p-Indicator">:</span> <span class="s">&#39;Last</span><span class="nv"> </span><span class="s">Name&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is for the one model, but there is <a href="https://github.com/rails/rails/blob/ebaf4e40cdcb80ebe16014a2c979f688213d7b92/activemodel/lib/active_model/translation.rb#L61">fallback code</a> in Active Model that also allows you to define the name for all models. You can do this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">en</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">last_name</span><span class="p-Indicator">:</span> <span class="s">&#39;Last</span><span class="nv"> </span><span class="s">Name&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This has the advantage of also working for another model as well as an Active Model <a href="https://blog.engineyard.com/2014/keeping-your-rails-controllers-dry-with-services">service objects</a> in one shot.</p>


		
		<a href="/blog/2015/01/06/translating-rails-fields/" class="more-link">Read on &rarr;</a>
	</div>

</article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2017

    Brian Leonard

</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'bleonard';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37352049-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



		</div>
	</div>
</body>
</html>
